<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Thanh To√°n</title>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="style.css"> 	
    </head>
    <body>
        
        <header>üí≥ Trang Thanh To√°n</header>
        <div class = "checkout-container">
            <h2 class="section-heading">1. Th√¥ng Tin Nh·∫≠n H√†ng</h2>
            <form id="checkout-form">
                <div class="form-group">
                    <label for="name">H·ªç v√† t√™n *</label>
                    <input type="text" id="name" required placeholder="Nguy·ªÖn VƒÉn A">
                </div>
                <div class="form-group">
                    <label for="phone">S·ªë ƒëi·ªán tho·∫°i *</label>
                    <input type="tel" id="phone" required placeholder="0901 234 567">
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="example@gmail.com">
                </div>
                <div class="form-group">
                    <label for="address">ƒê·ªãa ch·ªâ chi ti·∫øt *</label>
                    <textarea id="address" rows="3" required placeholder="S·ªë nh√†, ƒë∆∞·ªùng, ph∆∞·ªùng/x√£, qu·∫≠n/huy·ªán, t·ªânh/th√†nh ph·ªë"></textarea>
                </div>
                <div class="form-group">
                    <label for="note">Ghi ch√∫ ƒë∆°n h√†ng (t√πy ch·ªçn)</label>
                    <textarea id="note" rows="2" placeholder="V√≠ d·ª•: Giao h√†ng sau 17h, g·ªçi ƒëi·ªán tr∆∞·ªõc khi giao..."></textarea>
                </div>
                <h2 class="section-heading">2. Ph∆∞∆°ng Th·ª©c Thanh To√°n</h2>
                <div id="payment-methods">

                    <div class="payment-option selected" data-method="cod">
                        <input type="radio" name="payment-method" value="cod" id="payment-cod" checked>
                        <label for="payment-cod">üí∞ Thanh to√°n khi nh·∫≠n h√†ng (COD)</label>
                    </div>

                    <div class="payment-option" data-method="bank-transfer">
                        <input type="radio" name="payment-method" value="bank-transfer" id="payment-bank">
                        <label for="payment-bank">üè¶ Chuy·ªÉn kho·∫£n qua Ng√¢n h√†ng</label>
                    </div>
                    <div class="payment-details" id="details-bank-transfer">
                        <p>Ng√¢n h√†ng: **Vietcombank**</p>
                        <p>S·ªë t√†i kho·∫£n: **00110022334455**</p>
                        <p>Ch·ªß t√†i kho·∫£n: **NGUYEN VAN B**</p>
                        <p style="font-weight: 700; color: #dc3545;">N·ªôi dung chuy·ªÉn kho·∫£n: T√™n b·∫°n + SƒêT (V√≠ d·ª•: AN 0901234567)</p>
                    </div>

                    <div class="payment-option" data-method="card">
                        <input type="radio" name="payment-method" value="card" id="payment-card">
                        <label for="payment-card">üí≥ Th·∫ª Qu·ªëc t·∫ø (Visa, Mastercard, JCB)</label>
                    </div>
                    <div class="payment-details" id="details-card">
                        <div class="form-group">
                            <label for="card-number">S·ªë th·∫ª</label>
                            <input type="text" id="card-number" disabled placeholder="xxxx xxxx xxxx xxxx">
                        </div>
                        <div class="form-group" style="display: flex; gap: 10px;">
                            <div style="width: 50%;">
                                <label for="expiry-date">Ng√†y h·∫øt h·∫°n (MM/YY)</label>
                                <input type="text" id="expiry-date" disabled placeholder="MM/YY">
                            </div>
                            <div style="width: 50%;">
                                <label for="cvv">CVV</label>
                                <input type="text" id="cvv" disabled placeholder="xxx">
                            </div>
                        </div>
                    </div>

                </div>

                <h2 class="section-heading">3. T√≥m T·∫Øt & Ho√†n T·∫•t ƒê∆°n H√†ng</h2>
                <div class="checkout-summary">
                    <p>T·∫°m t√≠nh h√†ng h√≥a: <strong id="summary-subtotal">999.000‚Ç´</strong></p>
                    <p>Ph√≠ v·∫≠n chuy·ªÉn: <strong id="summary-shipping">30.000‚Ç´</strong></p>
                    <p class="total-row">T·ªïng thanh to√°n: <strong id="summary-total">1.029.000‚Ç´</strong></p>
                </div>

                <a href="../CartPage/cart.html" class="btn btn-back-to-cart">üõí Quay l·∫°i Gi·ªè h√†ng</a>

                <button type="submit" class="btn btn-place-order">ƒê·∫∑t h√†ng ngay</button>
            </form>
        </div>


        <script>
            // H√†m chuy·ªÉn ƒë·ªïi s·ªë sang ti·ªÅn t·ªá (s·ª≠ d·ª•ng l·∫°i t·ª´ code c≈©)
            function formatCurrency(number) {
                const safeNumber = Math.max(0, number);
                return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(safeNumber).replace('‚Ç´', '') + '‚Ç´';
            }

            // Gi√° tr·ªã m√¥ ph·ªèng (t·ª´ gi·ªè h√†ng)
            const SAVED_SUBTOTAL = parseInt(localStorage.getItem('cartSubtotal')) || 0;
            const SAVED_SHIPPING = parseInt(localStorage.getItem('cartShipping')) || 30000; 
            const SAVED_TOTAL = parseInt(localStorage.getItem('cartTotal')) || SAVED_SUBTOTAL + SAVED_SHIPPING;

            document.addEventListener('DOMContentLoaded', () => {

                document.getElementById('summary-subtotal').innerText = formatCurrency(SAVED_SUBTOTAL);
                document.getElementById('summary-shipping').innerText = formatCurrency(SAVED_SHIPPING);
                document.getElementById('summary-total').innerText = formatCurrency(SAVED_TOTAL);

                const paymentOptions = document.querySelectorAll('.payment-option');
                const radioInputs = document.querySelectorAll('input[name="payment-method"]');
                const cardInputs = document.querySelectorAll('#details-card input');
                
                /**
                 * C·∫≠p nh·∫≠t giao di·ªán v√† tr·∫°ng th√°i c·ªßa c√°c ph∆∞∆°ng th·ª©c thanh to√°n
                 */
                function updatePaymentMethod(selectedMethod) {
                    // ·∫®n t·∫•t c·∫£ c√°c chi ti·∫øt thanh to√°n
                    document.querySelectorAll('.payment-details').forEach(detail => {
                        detail.style.display = 'none';
                    });
                    
                    // V√¥ hi·ªáu h√≥a t·∫•t c·∫£ input th·∫ª
                    cardInputs.forEach(input => input.disabled = true);

                    // Th√™m/X√≥a class 'selected' cho border
                    paymentOptions.forEach(option => {
                        option.classList.remove('selected');
                        if (option.dataset.method === selectedMethod) {
                            option.classList.add('selected');
                            // ƒê·∫£m b·∫£o radio button ƒë∆∞·ª£c ch·ªçn ƒë√∫ng
                            option.querySelector('input[type="radio"]').checked = true;
                        }
                    });
                    
                    // Hi·ªÉn th·ªã chi ti·∫øt thanh to√°n ho·∫∑c k√≠ch ho·∫°t input c·∫ßn thi·∫øt
                    if (selectedMethod === 'bank-transfer') {
                        document.getElementById('details-bank-transfer').style.display = 'block';
                    } else if (selectedMethod === 'card') {
                        document.getElementById('details-card').style.display = 'block';
                        cardInputs.forEach(input => input.disabled = false);
                    }
                }

                // L·∫Øng nghe s·ª± ki·ªán CHANGE tr√™n radio button 
                radioInputs.forEach(input => {
                    input.addEventListener('change', (event) => {
                        const method = event.target.value;
                        updatePaymentMethod(method);
                    });
                });
                
                // Th√™m s·ª± ki·ªán CLICK cho DIV cha ƒë·ªÉ ch·ªçn radio n·∫øu click v√†o kho·∫£ng tr·ªëng
                paymentOptions.forEach(option => {
                    option.addEventListener('click', (event) => {
                        // Ki·ªÉm tra n·∫øu kh√¥ng click tr·ª±c ti·∫øp v√†o input/label, th√¨ t·ª± ƒë·ªông ch·ªçn radio
                        if (event.target.tagName !== 'INPUT' && event.target.tagName !== 'LABEL') {
                            const radio = option.querySelector('input[type="radio"]');
                            if (radio) {
                                radio.checked = true;
                                updatePaymentMethod(option.dataset.method);
                            }
                        }
                    });
                });

                // G·∫Øn s·ª± ki·ªán submit form
                document.getElementById('checkout-form').addEventListener('submit', (event) => {
                    event.preventDefault();
                    
                    // L·∫•y ph∆∞∆°ng th·ª©c thanh to√°n ƒë√£ ch·ªçn
                    const selectedPayment = document.querySelector('input[name="payment-method"]:checked').value;
                    const customerName = document.getElementById('name').value;
                    
                    alert(`‚úÖ ƒê∆°n h√†ng c·ªßa ${customerName} tr·ªã gi√° ${formatCurrency(SAVED_TOTAL)} ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t th√†nh c√¥ng!\n\nPh∆∞∆°ng th·ª©c thanh to√°n: ${selectedPayment.toUpperCase()}.\n\nCh√∫ng t√¥i s·∫Ω s·ªõm li√™n h·ªá x√°c nh·∫≠n.`);
                    
                    // Chuy·ªÉn h∆∞·ªõng ho·∫∑c x√≥a gi·ªè h√†ng (trong th·ª±c t·∫ø)
                    // window.location.href = 'thank-you-page.html';
                });
                
                // Thi·∫øt l·∫≠p tr·∫°ng th√°i ban ƒë·∫ßu (COD ƒë∆∞·ª£c ch·ªçn)
                updatePaymentMethod('cod');
            });
        </script>

    </body>
</html>